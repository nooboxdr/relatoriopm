<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Relatório de Patrulhamento PM</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <style>
    /* CSS sem alterações */
    body {
      font-family: Arial, sans-serif; padding: 5px; background-color: #f9f9f9;
      margin: 0; font-size: 10px;
    }
    .container {
      width: 100%; max-width: 800px; margin: 0 auto; background: white;
      box-shadow: 0 0 10px rgba(0,0,0,0.1  ); box-sizing: border-box;
    }
    .page { padding: 15px; background: white; }
    /* NOVO ESTILO PARA A IMAGEM DO CABEÇALHO */
    .header-img {
      width: 100%;
      margin-bottom: 10px;
    }
    .info-table-compact {
      width: 100%; border-collapse: collapse; margin-bottom: 10px;
    }
    .info-table-compact td {
      border: 1px solid #000; padding: 1px 3px; font-size: 9px;
    }
    .info-table-compact input {
      width: 100%; border: none; outline: none; font-size: 9px; background-color: transparent; padding: 2px 0;
    }
    .table-wrapper { overflow-x: auto; margin-bottom: 10px; }
    .data-table { width: 100%; border-collapse: collapse; font-size: 10px; }
    .data-table th, .data-table td { border: 1px solid #000; padding: 2px; text-align: center; vertical-align: middle; }
    .data-table input[type="text"] { width: 100%; border: none; outline: none; font-size: 10px; background-color: transparent; }
    .criminal-check {
      display: flex; align-items: center; justify-content: center; gap: 3px; white-space: nowrap;
    }
    .criminal-check label {
      display: flex; align-items: center; gap: 2px; cursor: pointer;
      font-size: 8px;
    }
    .criminal-check input[type="checkbox"] {
      width: 10px; height: 10px; margin: 0;
    }
    .section-title { font-size: 11px; font-weight: bold; margin: 10px 0 5px; }
    .sintese { width: 100%; box-sizing: border-box; font-size: 10px; padding: 5px; border: 1px solid #000; margin: 5px 0; height: 250px; }
    .signature {
      margin-top: 20px; display: flex; justify-content: space-between; font-size: 10px;
    }
    .signature div {
      width: 48%; text-align: center;
    }
    .footer { text-align: center; font-size: 9px; margin-top: 20px; font-style: italic; line-height: 1.3; }
    .btn-container { text-align: center; padding: 15px; background-color: #f0f0f0; }
    .btn { padding: 10px 15px; margin: 5px; font-size: 12px; background-color: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; }
    .btn-clear { background-color: #dc3545; }
  </style>
</head>
<body>

  <div class="container">
    <!-- PÁGINA 1 -->
    <div id="pagina1" class="page">
      <!-- CABEÇALHO DE TEXTO SUBSTITUÍDO PELA IMAGEM -->
      <img src="cabecalho.png" alt="Cabeçalho do Relatório" class="header-img"/>
      
      <table class="info-table-compact">
        <tr><td>CÓDIGO DA OPM: <input type="text"></td><td>VIATURA: <input type="text"></td></tr>
        <tr><td>DATA: <input type="text" id="data-automatica"></td><td>TURNO: <input type="text"></td></tr>
        <tr><td>ENC./RE: <input type="text"></td><td>MOT./RE: <input type="text"></td></tr>
        <tr><td>OBS: <input type="text"></td><td>OBS: <input type="text"></td></tr>
      </table>
      <div class="section-title">ABORDAGENS REALIZADAS A PESSOAS</div>
      <div class="table-wrapper"><table class="data-table" id="tabela-pessoas"></table></div>
    </div>

    <!-- PÁGINA 2 -->
    <div id="pagina2" class="page">
      <div class="section-title">ABORDAGENS A VEÍCULOS</div>
      <div class="table-wrapper"><table class="data-table" id="tabela-veiculos"></table></div>
      <div class="section-title">OCORRÊNCIAS LEI "MARIA DA PENHA"</div>
      <div class="table-wrapper"><table class="data-table" id="tabela-penha"></table></div>
    </div>

    <!-- PÁGINA 3 -->
    <div id="pagina3" class="page">
      <div class="section-title">ESTATÍSTICA DA EQUIPE</div>
      <div class="table-wrapper"><table class="data-table" id="tabela-estatistica"></table></div>
      <div class="section-title">SINTESE DO SERVIÇO</div>
      <textarea class="sintese" id="sintese"></textarea>
      <div class="signature">
        <div>ENC. DE EQUIPE:  
___________________________</div>
        <div>VISTO DO CMT CIA:  
_________________________</div>
      </div>
      <div class="footer">
        "Nós, Policiais Militares, estamos compromissados com a Defesa da Vida, da Integridade Física e da Dignidade da Pessoa Humana"
      </div>
    </div>
  </div>

  <div class="btn-container">
    <button class="btn" onclick="gerarPDF()">Gerar PDF</button>
    <button class="btn btn-clear" onclick="limparForm()">Limpar</button>
  </div>
  
  <script>
    // Scripts de popular tabelas e data (sem alterações)
    function popularTabelas() {
      const tabelaPessoas = document.getElementById('tabela-pessoas');
      let htmlPessoas = '<thead><tr><th>NOME</th><th>RG/CIC</th><th>LOCAL</th><th>QTR</th><th>Criminal</th><th>Art.</th></tr></thead><tbody>';
      for (let i = 0; i < 12; i++) { htmlPessoas += `<tr><td><input type="text"></td><td><input type="text"></td><td><input type="text"></td><td><input type="text"></td><td><div class="criminal-check"><label><input type="checkbox"> S</label>/<label><input type="checkbox"> N</label></div></td><td><input type="text"></td></tr>`; }
      tabelaPessoas.innerHTML = htmlPessoas + '</tbody>';
      const tabelaVeiculos = document.getElementById('tabela-veiculos');
      let htmlVeiculos = '<thead><tr><th>MARCA/MOD</th><th>PLACAS</th><th>CONDUTOR</th><th>PGU</th><th>LOCAL</th><th>QTR</th><th>Criminal</th><th>Art.</th></tr></thead><tbody>';
      for (let i = 0; i < 10; i++) { htmlVeiculos += `<tr><td><input type="text"></td><td><input type="text"></td><td><input type="text"></td><td><input type="text"></td><td><input type="text"></td><td><input type="text"></td><td><div class="criminal-check"><label><input type="checkbox"> S</label>/<label><input type="checkbox"> N</label></div></td><td><input type="text"></td></tr>`; }
      tabelaVeiculos.innerHTML = htmlVeiculos + '</tbody>';
      document.getElementById('tabela-penha').innerHTML = `<thead><tr><th>NOME</th><th>TEL</th><th>BOPM</th><th>BOPC</th><th>NATUREZA</th><th>VISITA PM</th></tr></thead><tbody><tr><td><input type="text"></td><td><input type="text"></td><td><input type="text"></td><td><input type="text"></td><td><input type="text"></td><td><div class="criminal-check"><label><input type="checkbox"> SIM</label>/<label><input type="checkbox"> NÃO</label></div></td></tr></tbody>`;
      document.getElementById('tabela-estatistica').innerHTML = `<thead><tr><th>PESSOAS</th><th>VEÍCULOS</th><th>MOTOS</th><th>AIT/AI</th><th>CR</th><th>ARMAS</th><th>FLAGRANTES</th><th>OUTROS</th></tr></thead><tbody><tr><td><input type="text"></td><td><input type="text"></td><td><input type="text"></td><td><input type="text"></td><td><input type="text"></td><td><input type="text"></td><td><input type="text"></td><td><input type="text"></td></tr><tr><td colspan="8">Nº SUBSETORES / CPP: <input type="text" style="width: 80%;"></td></tr></tbody>`;
    }
    function preencherData() {
        const hoje = new Date();
        const dia = String(hoje.getDate()).padStart(2, '0');
        const mes = String(hoje.getMonth() + 1).padStart(2, '0');
        const ano = hoje.getFullYear();
        document.getElementById('data-automatica').value = `${dia}/${mes}/${ano}`;
    }
    document.addEventListener('DOMContentLoaded', () => {
        popularTabelas();
        preencherData();
    });

    // SCRIPT ATUALIZADO PARA 3 PÁGINAS
    async function gerarPDF() {
      const { jsPDF } = window.jspdf;
      const pdf = new jsPDF({ orientation: "portrait", unit: "mm", format: "a4" });
      
      const paginas = [document.getElementById('pagina1'), document.getElementById('pagina2'), document.getElementById('pagina3')];
      
      for (let i = 0; i < paginas.length; i++) {
        const pagina = paginas[i];
        // Adicionado para garantir que a imagem seja renderizada corretamente no PDF
        const options = { scale: 4, useCORS: true };
        
        const canvas = await html2canvas(pagina, options);
        const imgData = canvas.toDataURL('image/jpeg', 1.0);
        const page_width = pdf.internal.pageSize.getWidth();
        const content_width = page_width * 0.95;
        const content_height = (canvas.height * content_width) / canvas.width;
        const x_margin = (page_width - content_width) / 2;
        const y_margin = 5;
        
        if (i > 0) { pdf.addPage(); }
        pdf.addImage(imgData, 'JPEG', x_margin, y_margin, content_width, content_height);
      }
      pdf.save("relatorio_patrulhamento.pdf");
    }

    function limparForm() {
      document.querySelectorAll('input[type="text"], textarea').forEach(input => {
          if(input.id !== 'data-automatica') {
              input.value = "";
          }
      });
      document.querySelectorAll('input[type="checkbox"]').forEach(checkbox => checkbox.checked = false);
    }
  </script>

</body>
</html>
